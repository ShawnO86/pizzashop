<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{/common-head :: common_html_head(${pageTitle}, ${additionalStyles})}"></head>

<body>
<header th:insert="~{header :: head(${heading}, ${secondaryHeading})}"></header>
<main class="menu-layout">
  <div class="menu-category-nav">
    <ul>
      <li><a href="#PASTA">Pasta</a></li>
      <li><a href="#PIZZA">Pizza</a></li>
      <li><a href="#APP">Appetizers</a></li>
      <li><a href="#DRINK">Drinks</a></li>
    </ul>
    <div class="menu-modal-btns">
      <button id="open-pizza-builder-btn">Build A Custom Pizza
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
          <path d="M169.7 .9c-22.8-1.6-41.9 14-47.5 34.7L110.4 80c.5 0 1.1 0 1.6 0c176.7 0 320 143.3 320 320c0
         .5 0 1.1 0 1.6l44.4-11.8c20.8-5.5 36.3-24.7 34.7-47.5C498.5 159.5 352.5 13.5 169.7 .9zM399.8 410.2c.1-3.4
          .2-6.8 .2-10.2c0-159.1-128.9-288-288-288c-3.4 0-6.8 .1-10.2 .2L.5 491.9c-1.5 5.5 .1 11.4 4.1 15.4s9.9 5.6 15.4
           4.1L399.8 410.2zM176 208a32 32 0 1 1 0 64 32 32 0 1 1 0-64zm64 128a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM96 384a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"/>
        </svg>
      </button>
      <button id="show-cart-btn">
        Show Cart
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
          <!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.-->
          <path d="M0 24C0 10.7 10.7 0 24 0L69.5 0c22 0 41.5 12.8 50.6 32l411 0c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3l-288.5 0 5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5L488 336c13.3 0 24 10.7 24 24s-10.7 24-24 24l-288.3 0c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5L24 48C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/>
        </svg>
      </button>
    </div>
  </div>
  <section id="cart">
    <div th:if="${cartError}" class="error" id="cart-errors" th:each="error : ${cartError}">
      <i th:text="${error}"></i>
    </div>
    <div th:if="${availabilityErrors}" class="error" id="availability-errors" th:each="error : ${availabilityErrors}">
      <i th:text="${error}"></i>
    </div>
    <div th:if="${priceErrors}" class="error" id="price-errors" th:each="error : ${priceErrors}">
      <i th:text="${error}"></i>
    </div>
    <dialog id="cart-container">
      <div class="space-between vertical-center">
        <h2>Cart</h2>
        <button id="hide-cart-btn">Continue Order</button>
      </div>
      <form id="menuAmount-container" th:action="@{/order/processOrder}" method="post" th:object="${order}">
        <div id="menuItems-display">

        </div>

        <div id="customPizzas-display">

        </div>

        <div class="cart-info">
          <h4 class="space-between">
            <span>Order Total:</span> <span id="order-total">0.00</span>
          </h4>
          <input type="hidden" id="order-total-input" th:field="*{totalPrice}" th:name="*{totalPrice}" value="0"/>
          <input type="button" id="cart-submit-btn" value="Submit Order" sec:authorize="hasRole('ROLE_CUSTOMER')"/>

          <p sec:authorize="isAnonymous()" class="error">
            <span>You may continue creating this order, to place it you must</span>
            <span><a th:href="@{/login}">log-in</a> or call us at 123-456-7890.</span>
          </p>
        </div>
      </form>
    </dialog>
  </section>

  <section id="menuItems-container">
    <script th:inline="javascript">
      const pizzaPriceMap = {
        'SMALL': [],
        'MEDIUM': [],
        'LARGE': []
      }
      const orderDTO = {
        'menuItems': /*[[${order.menuItemList}]]*/,
        'pizzaItems': /*[[${order.customPizzaList}]]*/,
      };
      let openPizzaBuilder = /*[[${openPizza}]]*/;
    </script>
    <div th:each="category : ${menuItemsByCategory}" class="menu-item-category">
      <h3 th:text="${category.key}" th:id="${category.key}" class="category-heading"></h3>
      <hr>
      <div th:each="menuItem : ${category.value}" th:if="${menuItem.isAvailable}" class="menu-item">
          <h4 th:text="${menuItem.dishName}"></h4>
          <p th:text="${menuItem.description}"></p>
          <p th:text="${#numbers.formatCurrency(menuItem.priceCents / 100.0)}"></p>


        <div class="space-between">
          <input type="number" placeholder="Qty" min="1" th:max="${menuItem.amountAvailable}" />
          <button class="addMenuItem-btn" th:data-item-name="${menuItem.dishName}"
                  th:data-item-id="${menuItem.id}" th:data-item-price="${menuItem.priceCents}"
                  th:data-item-max="${menuItem.amountAvailable}">Add To Order</button>
        </div>


        <div th:if="${category.key == 'PIZZA'}">
          <script th:inline="javascript">
            switch (/*[[${menuItem.dishName}]]*/) {
              case 'Small Cheese Pizza':
                pizzaPriceMap.SMALL = {price: /*[[${menuItem.priceCents}]]*/,maxQty: /*[[${menuItem.amountAvailable}]]*/};
                break;
              case 'Medium Cheese Pizza':
                pizzaPriceMap.MEDIUM = {price: /*[[${menuItem.priceCents}]]*/,maxQty: /*[[${menuItem.amountAvailable}]]*/};
                break;
              case 'Large Cheese Pizza':
                pizzaPriceMap.LARGE = {price: /*[[${menuItem.priceCents}]]*/,maxQty: /*[[${menuItem.amountAvailable}]]*/};
            }
          </script>
        </div>
      </div>
    </div>
  </section>

  <section id="pizza-builder-container">
    <dialog class="pizza-builder">
      <div>
        <h3>Build a custom pizza</h3>
        <label class="space-between"><strong>Name:</strong>
          <input type="text" placeholder="pizza name" id="pizza-name-input"/>
        </label>
      </div>

      <div id="pizza-size-container">
        <h4>Size:</h4>
        <div th:each="size : ${pizzaSizes}" class="space-between">
          <div>
            <input type="radio" name="pizzaSizeRadios" class="input-box" th:id="${size.name().toLowerCase() + '-radio'}" th:if="${size.name() == 'SMALL'}"
                   th:data-pizza-size="${size.name()}" th:data-ingredient-amount="${size.ingredientAmount}"
                   th:data-extra-ingredient-amount="${size.extraIngredientAmount}" checked />
            <input type="radio" name="pizzaSizeRadios" class="input-box" th:id="${size.name().toLowerCase() + '-radio'}" th:if="${size.name() != 'SMALL'}"
                   th:data-pizza-size="${size.name()}" th:data-ingredient-amount="${size.ingredientAmount}"
                   th:data-extra-ingredient-amount="${size.extraIngredientAmount}" />
            <label th:for="${size.name().toLowerCase() + '-radio'}" class="input-box">
              <span th:text="${#strings.capitalize(size.name().toLowerCase()) + ' - (' + size.description + '):'}"></span>
            </label>
          </div>
          <span th:class="${'pizza-size-price ' + size.name()}"></span>
        </div>
      </div>

      <div id="pizza-topping-container">
        <h4>Toppings:</h4>
        <div th:each="topping : ${pizzaToppings}" class="space-between" th:if="${topping.ingredientName != 'Mozzarella'}">
          <div>
            <input type="checkbox" name="toppingCheckboxes" class="input-box" th:id="${topping.ingredientName + '-chkbox'}" th:data-topping-id="${topping.id}"
                   th:data-topping-name="${topping.ingredientName}" th:data-topping-price="${topping.getCentsPricePer()}" data-topping-type="regular">
            <label th:text="${topping.ingredientName + ':'}" th:for="${topping.ingredientName + '-chkbox'}" class="input-box"></label>
          </div>
          <span class="ingredient-data" th:data-ingredient-price="${topping.getCentsPricePer()}"
                th:data-ingredient-name="${topping.ingredientName}">price</span>
        </div>

        <h4>Extra Toppings:<br>
          <sub>(Addition to or light amount.)</sub>
        </h4>

        <div th:each="topping : ${pizzaToppings}" class="space-between">
          <div>
            <input type="checkbox" name="extraToppingCheckboxes" class="input-box" th:id="${'extra-'+topping.ingredientName + '-chkbox'}" th:data-topping-id="${topping.id}"
                   th:data-topping-name="${topping.ingredientName}" th:data-topping-price="${topping.getCentsPricePer()}" data-topping-type="extra">
            <label th:text="${topping.ingredientName + ':'}" th:for="${'extra-' + topping.ingredientName + '-chkbox'}" class="input-box"></label>
          </div>
          <span class="extra-ingredient-data" th:data-ingredient-price="${topping.getCentsPricePer()}"
                th:data-ingredient-name="${topping.ingredientName}">price</span>
        </div>
      </div>

      <div class="pizza-builder-actions">
        <label>Qty:
          <input type="number" min="1" id="pizza-qty-input" value="1"/>
        </label>
        <button type="button" class="addMenuItem-btn" id="pizza-cancel-btn">Cancel</button>
        <button type="submit" class="addMenuItem-btn" id="pizza-submit-btn" data-add-type="add">Add To Order</button>
      </div>

      <strong><sub class="space-between"><span>Per Pizza:</span><span id="pizza-price-per"></span></sub></strong>
      <strong><sub class="space-between"><span id="pizza-qty-display"></span><span id="pizza-price-total"></span></sub></strong>
    </dialog>
  </section>



</main>

</body>

<script src="/js/addMenuItems.js" type="module"></script>
<script src="/js/pizzaBuilder.js" type="module"></script>
<script src="/js/orderFormMain.js" type="module"></script>
</html>