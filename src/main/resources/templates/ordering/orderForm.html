<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pizza Shop System</title>
  <link rel="stylesheet" type="text/css" href="/styles/main.css">
</head>

<body>
<header th:insert="~{header :: head}"></header>

<main class="inline">

  <section id="menuItems-container">
    <button id="open-pizza-builder-btn">Build Your Own Pizza</button>
    <script th:inline="javascript">
      const pizzaPriceMap = {
        'SMALL': [],
        'MEDIUM': [],
        'LARGE': []
      }
      const orderDTO = {
        'menuItems': /*[[${order.menuItemList}]]*/,
        'pizzaItems': /*[[${order.customPizzaList}]]*/,
      };
    </script>
    <div th:each="category : ${menuItemsByCategory}">
      <h3 th:text="${category.key}"></h3>

      <div th:each="menuItem : ${category.value}">
        <div th:if="${menuItem.isAvailable}">
          <h4 th:text="${menuItem.dishName}"></h4>
          <p th:text="${menuItem.description}"></p>
          <p th:text="${#numbers.formatCurrency(menuItem.priceCents / 100.0)}"></p>
        </div>

        <input type="number" placeholder="Qty" min="1" th:max="${menuItem.amountAvailable}" />
        <button class="addMenuItem-btn" th:data-item-name="${menuItem.dishName}"
                th:data-item-id="${menuItem.id}" th:data-item-price="${menuItem.priceCents}"
                th:data-item-max="${menuItem.amountAvailable}">Add To Order</button>

        <div th:if="${category.key == 'PIZZA'}">
          <script th:inline="javascript">
            switch (/*[[${menuItem.dishName}]]*/) {
              case 'Small Cheese Pizza':
                pizzaPriceMap.SMALL = {price: /*[[${menuItem.priceCents}]]*/,maxQty: /*[[${menuItem.amountAvailable}]]*/};
                break;
              case 'Medium Cheese Pizza':
                pizzaPriceMap.MEDIUM = {price: /*[[${menuItem.priceCents}]]*/,maxQty: /*[[${menuItem.amountAvailable}]]*/};
                break;
              case 'Large Cheese Pizza':
                pizzaPriceMap.LARGE = {price: /*[[${menuItem.priceCents}]]*/,maxQty: /*[[${menuItem.amountAvailable}]]*/};
            }
          </script>
        </div>
      </div>
    </div>
  </section>

  <!-- todo: set to overlay menu with higher z-index -->
  <section class="form-container hide-area" id="pizza-builder-container">
    <div>
      <h3>Build your custom pizza:</h3>
      <label class="space-between"><strong>Name:</strong>
        <input type="text" placeholder="pizza name" id="pizza-name-input"/>
      </label>
    </div>

    <div id="pizza-size-container">
      <h4>Size:</h4>
      <div th:each="size : ${pizzaSizes}" class="space-between">
        <div>
          <input type="radio" name="pizzaSizeRadios" th:id="${size.name().toLowerCase() + '-radio'}" th:if="${size.name() == 'SMALL'}"
                 th:data-pizza-size="${size.name()}" th:data-ingredient-amount="${size.ingredientAmount}"
                 th:data-extra-ingredient-amount="${size.extraIngredientAmount}" checked />
          <input type="radio" name="pizzaSizeRadios" th:id="${size.name().toLowerCase() + '-radio'}" th:if="${size.name() != 'SMALL'}"
                 th:data-pizza-size="${size.name()}" th:data-ingredient-amount="${size.ingredientAmount}"
                 th:data-extra-ingredient-amount="${size.extraIngredientAmount}" />
          <label th:for="${size.name().toLowerCase() + '-radio'}">
            <span th:text="${size.name().toLowerCase() + ' - (' + size.description + '):'}"></span>
          </label>
        </div>
        <span th:class="${'pizza-size-price ' + size.name()}"></span>
      </div>
    </div>

    <div id="pizza-topping-container">
      <h4>Toppings:</h4>
      <div th:each="topping : ${pizzaToppings}" class="space-between" th:if="${topping.ingredientName != 'Mozzarella'}">
        <div>
          <input type="checkbox" name="toppingCheckboxes" th:id="${topping.ingredientName + '-chkbox'}" th:data-topping-id="${topping.id}"
                 th:data-topping-name="${topping.ingredientName}" th:data-topping-price="${topping.getCentsPricePer()}" data-topping-type="regular">
          <label th:text="${topping.ingredientName + ':'}" th:for="${topping.ingredientName + '-chkbox'}"></label>
        </div>
        <span class="ingredient-data" th:data-ingredient-price="${topping.getCentsPricePer()}"
              th:data-ingredient-name="${topping.ingredientName}">price</span>
      </div>

      <h4>Extra Toppings:<br>
        <sub>(Addition to or light amount.)</sub>
      </h4>

      <div th:each="topping : ${pizzaToppings}" class="space-between">
        <div>
          <input type="checkbox" name="extraToppingCheckboxes" th:id="${'extra-'+topping.ingredientName + '-chkbox'}" th:data-topping-id="${topping.id}"
                 th:data-topping-name="${topping.ingredientName}" th:data-topping-price="${topping.getCentsPricePer()}" data-topping-type="extra">
          <label th:text="${topping.ingredientName + ':'}" th:for="${'extra-' + topping.ingredientName + '-chkbox'}"></label>
        </div>
        <span class="extra-ingredient-data" th:data-ingredient-price="${topping.getCentsPricePer()}"
              th:data-ingredient-name="${topping.ingredientName}">price</span>
      </div>
    </div>

    <div class="space-between">
      <label>Qty:
        <input type="number" min="1" id="pizza-qty-input" value="1"/>
      </label>
      <button type="submit" class="addMenuItem-btn" id="pizza-cancel-btn">Cancel</button>
      <button type="submit" class="addMenuItem-btn" id="pizza-submit-btn" data-add-type="add">Add To Order</button>
    </div>

    <strong><sub class="space-between"><span>Per Pizza:</span><span id="pizza-price-per"></span></sub></strong>
    <strong><sub class="space-between"><span id="pizza-qty-display"></span><span id="pizza-price-total"></span></sub></strong>
  </section>

  <section class="stay-top" id="cart">

    <div id="cart-container" class="form-container">

      <form id="menuAmount-container" th:action="@{/order/processOrder}" method="post" th:object="${order}">
        <div th:if="${cartError}" class="error" id="cart-errors" th:each="error : ${cartError}">
          <i th:text="${error}"></i>
        </div>
        <div th:if="${availabilityErrors}" class="error" id="availability-errors" th:each="error : ${availabilityErrors}">
          <i th:text="${error}"></i>
        </div>
        <div th:if="${priceErrors}" class="error" id="price-errors" th:each="error : ${priceErrors}">
          <i th:text="${error}"></i>
        </div>

        <div id="menuItems-display">

        </div>

        <div id="customPizzas-display">

        </div>

        <h4 class="space-between"><span>Order Total:</span> <span id="order-total">0.00</span></h4>
        <input type="hidden" id="order-total-input" th:field="*{totalPrice}" th:name="*{totalPrice}" value="0"/>
        <input type="button" id="cart-submit-btn" value="Submit Order" sec:authorize="hasRole('ROLE_CUSTOMER')"/>
      </form>
      <p sec:authorize="isAnonymous()" class="error">
        <span>Log in to place an order,</span><br>
        <span>or call 123-456-7890</span>
      </p>
    </div>

  </section>

</main>

</body>

<script src="/js/addMenuItems.js" type="module"></script>
<script src="/js/pizzaBuilder.js" type="module"></script>
<script src="/js/orderFormMain.js" type="module"></script>
</html>